apiVersion: v1
kind: ConfigMap
metadata:
  name: airflow-config
  namespace: airflow
data:
  # ---------------------------
  # Core
  # ---------------------------
  AIRFLOW__CORE__EXECUTOR: CeleryExecutor
  AIRFLOW__CORE__DAGS_FOLDER: /opt/airflow/dags
  AIRFLOW__CORE__LOAD_EXAMPLES: "False"
  AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION: "True"
  AIRFLOW__CORE__HOSTNAME_CALLABLE: airflow.utils.net.get_host_ip_address

  # ---------------------------
  # Authentication (FAB)
  # ---------------------------
  AIRFLOW__CORE__AUTH_MANAGER: airflow.providers.fab.auth_manager.fab_auth_manager.FabAuthManager
  AIRFLOW__API__AUTH_BACKENDS: airflow.api.auth.backend.basic_auth

  # ---------------------------
  # Logging  (CRITICAL SECTION)
  # ---------------------------
  AIRFLOW__LOGGING__REMOTE_LOGGING: "False"
  AIRFLOW__LOGGING__LOGGING_LEVEL: INFO

  # Worker log serving (THIS FIXES http://:8793)
  AIRFLOW__LOGGING__WORKER_LOG_SERVER_HOST: airflow-worker.airflow.svc.cluster.local
  AIRFLOW__LOGGING__WORKER_LOG_SERVER_PORT: "8793"

  # ðŸ”‘ REQUIRED for API SERVER (this is what was missing)
  AIRFLOW__LOGGING__WORKER_LOG_SERVER_HOSTNAME_CALLABLE: airflow.utils.net.get_hostname

  AIRFLOW__LOGGING__HOSTNAME_CALLABLE: airflow.utils.net.get_host_ip_address

  # ---------------------------
  # Webserver / API
  # ---------------------------
  AIRFLOW__WEBSERVER__ENABLE_PROXY_FIX: "True"
  AIRFLOW__WEBSERVER__BASE_URL: https://airflow.pushparag.online
  AIRFLOW__API__HOSTNAME_CALLABLE: airflow.utils.net.get_host_ip_address

  # ---------------------------
  # Scheduler
  # ---------------------------
  AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL: "300"
  AIRFLOW__SCHEDULER__SCHEDULER_HEARTBEAT_SEC: "5"

  # ---------------------------
  # Misc
  # ---------------------------
  PYTHONPATH: /opt/airflow
